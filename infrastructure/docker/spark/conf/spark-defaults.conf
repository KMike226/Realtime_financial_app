# Configuration Spark par défaut pour conteneurs
# ===============================================
# Configuration optimisée pour l'exécution dans ECS/EKS

# Configuration générale
spark.master                     k8s://https://kubernetes.default.svc.cluster.local:443
spark.submit.deployMode          cluster
spark.kubernetes.namespace      financial-app
spark.kubernetes.container.image.pullPolicy Always
spark.kubernetes.authenticate.driver.serviceAccountName spark-driver
spark.kubernetes.executor.deleteOnTermination true

# Configuration des ressources
spark.driver.memory              2g
spark.driver.cores               2
spark.executor.memory            4g
spark.executor.cores             2
spark.executor.instances         3

# Configuration SQL adaptative
spark.sql.adaptive.enabled true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled true
spark.sql.adaptive.localShuffleReader.enabled true

# Configuration des partitions
spark.sql.shuffle.partitions     200
spark.default.parallelism        200

# Configuration de la sérialisation
spark.serializer                 org.apache.spark.serializer.KryoSerializer
spark.kryo.unsafe                true
spark.kryo.registrationRequired  false

# Configuration des logs
spark.eventLog.enabled           true
spark.eventLog.dir               /tmp/spark-events
spark.history.fs.logDirectory    /tmp/spark-events

# Configuration AWS
spark.hadoop.fs.s3a.impl         org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.aws.credentials.provider com.amazonaws.auth.DefaultAWSCredentialsProviderChain
spark.hadoop.fs.s3a.endpoint     s3.amazonaws.com
spark.hadoop.fs.s3a.path.style.access false

# Configuration Kinesis
spark.streaming.kinesis.region   us-east-1
spark.streaming.kinesis.credentials.provider com.amazonaws.auth.DefaultAWSCredentialsProviderChain

# Configuration des métriques
spark.metrics.conf.*.sink.console.class org.apache.spark.metrics.sink.ConsoleSink
spark.metrics.conf.*.sink.console.period 10
spark.metrics.conf.*.sink.console.unit seconds

# Configuration de sécurité
spark.authenticate               true
spark.authenticate.secret        ${SPARK_AUTHENTICATE_SECRET}

# Configuration des applications financières
spark.sql.execution.arrow.pyspark.enabled true
spark.sql.execution.arrow.maxRecordsPerBatch 10000

# Configuration des indicateurs techniques
spark.sql.adaptive.advisoryPartitionSizeInBytes 64MB
spark.sql.adaptive.skewJoin.skewedPartitionFactor 5
spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes 256MB
